<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Project: DPL workflows for the TPC</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../o2_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d6/d82/md__home_travis_build_AliceO2Group_AliceO2_Detectors_TPC_workflow_README.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">DPL workflows for the TPC </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>TPC reconstruction workflow</h2>
<p>The TPC reconstruction workflow starts from the TPC digits, the <em>clusterer</em> reconstructs clusters. Those are <em>converted</em> to RAW pages and passed onto the <em>decoder</em> providing the decoded (native) cluster format to the <em>tracker</em>.</p>
<p>The workflow consists of the following DPL processors:</p>
<ul>
<li><code>digit-reader</code> -&gt; using tool <a href="../../../../../Framework/Utils/include/Utils/RootTreeReader.h">o2::framework::RootTreeReader</a></li>
<li><code>clusterer</code> -&gt; interfaces <a href="../../../reconstruction/include/TPCReconstruction/HwClusterer.h">o2::TPC::HwClusterer</a></li>
<li><code>converter</code> -&gt; implements conversions to raw pages, to be moved to a worker class</li>
<li><code>decoder</code> -&gt; interfaces <a href="../../reconstruction/include/TPCReconstruction/HardwareClusterDecoder.h">o2::TPC::HardwareClusterDecoder</a></li>
<li><code>tracker</code> -&gt; interfaces <a href="../../reconstruction/include/TPCReconstruction/TPCCATracking.h">o2::TPC::TPCCATracking</a></li>
<li><code>writer</code> -&gt; implements simple writing to ROOT file</li>
</ul>
<p>Clusters are created and processed together with the MC labels, however track labels are not yet written to output file. This will come soon.</p>
<h3>Input data</h3>
<p>The input can be created by running the simulation (<code>o2sim</code>) and the digitizer workflow (<code>digitizer-workflow</code>). The digitizer workflow produces the file <code>tpcdigits.root</code> by default, data is stored in separated branches for all sectors.</p>
<h3>Quickstart running the reconstruction workflow</h3>
<p>The workflow is implemented in the <code>tpc-reco-workflow</code> executable.</p>
<p>Display all options ``` tpc-reco-workflow &ndash;help ```</p>
<p>Important options for the <code>digit-reader</code> as initial publisher ``` &ndash;infile arg Name of the input file &ndash;treename arg (=o2sim) Name of the input tree &ndash;digitbranch arg (=TPCDigit) Digit branch &ndash;mcbranch arg (=TPCDigitMCTruth) MC info branch &ndash;tpc-sectors arg (=0-35) TPC sector range, e.g. 5-7,8,9 ```</p>
<p>Options for the <code>tpc-track-writer</code> process ``` &ndash;outfile arg (=tpctracks.root) Name of the input file &ndash;treename arg (=o2sim) Name of output tree &ndash;track-branch-name arg (=TPCTracks) Branch name for TPC tracks &ndash;trackmc-branch-name arg (=TPCTracksMCTruth) Branch name for TPC track mc labels ```</p>
<p>Examples: ``` tpc-reco-workflow &ndash;infile tpcdigits.root &ndash;tpc-sectors 0-15 ```</p>
<p>``` tpc-reco-workflow &ndash;infile tpcdigits.root &ndash;tpc-sectors 0-15 &ndash;disable-mc 1 ```</p>
<h3>Global workflow options:</h3>
<p>``` &ndash;input-type arg (=digits) digits, clusters, raw &ndash;output-type arg (=tracks) clusters, raw, tracks &ndash;disable-mc arg (=0) disable sending of MC information &ndash;tpc-lanes arg (=1) number of parallel lanes up to the tracker ``<code> Support for all other output types than</code>tracks` is going to be implemented soon, multiple outputs will be supported in order to keep the data at intermediate steps.</p>
<h4>Parallel processing</h4>
<p>Parallel processing is controlled by the option <code>--tpc-lanes n</code>. The digit reader will fan out to n processing lanes, each with clusterer, converter and decoder. The tracker will fan in from the parallel lanes.</p>
<h3>Processor options</h3>
<h4>TPC CA tracker</h4>
<p>The <a href="../../src/CATrackerSpec.cxx">tracker spec</a> interfaces the <a href="../../reconstruction/include/TPCReconstruction/TPCCATracking.h">o2::TPC::TPCCATracking</a> worker class which can be initialized using an option string. The processor spec defines the option <code>--tracker-option</code>. Currently, the tracker should be run with options ``` &ndash;tracker-option "refX=83 cont" ```</p>
<p>The most important tracker options are: ``` cont activation of continuous mode refX= reference x coordinate, tracker tries to propagate all track to the reference bz= magnetic field ```</p>
<h3>Current limitations</h3>
<ul>
<li>track labels not yet written to file</li>
<li>only the full workflow with input type <code>digits</code> and output type <code>tracks</code> has been tested so far</li>
<li>the propagation of MC labels goes together with multiple rearrangements and thus copy</li>
<li>only one timeframe is processed, this matches the current working scheme of the digitizer workflow</li>
<li>sequential workflow where the TPC sectors are processed individually and the data is buffered in the tracker until complete. We are currently (ab)using DPLs time slice concept to process individual TPC sectors. This is probably anyhow solved sufficiently when the trigger timing is implemented in DPL</li>
<li>raw pages are using RawDataHeader version 2 with 4 64bit words, will be converted to version 3 soon</li>
</ul>
<h2>Open questions</h2>
<ul>
<li>how to implement further workflow control with multiple timeframes</li>
<li>clarify the buffering of input in the tracker</li>
<li>clarify whether or not to call <code>finishProcessing</code> of the clusterer</li>
<li>the tracker reports about clusters being dropped, can be an indication that some conversion step in the workflow is incorrect. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Oct 31 2018 08:58:29 for Project by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
